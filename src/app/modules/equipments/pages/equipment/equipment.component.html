<div class="header">
  <h2>Equipment Management</h2>
  <div class="header-buttons">
    <button
      pButton
      type="button"
      label="Add Equipment"
      icon="pi pi-plus"
      (click)="showAddEquipment()"
      class="p-button-success add-equipment-btn"
    ></button>
    <button
      pButton
      type="button"
      label="Reload Assets"
      icon="pi pi-refresh"
      (click)="retryLoadAssets()"
      [loading]="loading"
    ></button>
  </div>
</div>

<div class="content">
  <!-- Add Equipment Section -->
  <div *ngIf="showAddForm" class="add-equipment-section">
    <app-add-equipment
      (cancel)="hideAddEquipment()"
      (equipmentAdded)="onEquipmentAdded($event)"
    ></app-add-equipment>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading assets...</p>
  </div>

  <!-- Error display -->
  <div *ngIf="error && !loading" class="error-container">
    <p-message severity="error" [text]="error"></p-message>
    <button
      pButton
      type="button"
      label="Retry"
      icon="pi pi-refresh"
      (click)="retryLoadAssets()"
    ></button>
  </div>

  <!-- Assets display -->
  <div *ngIf="!loading && !error">
    <h3>Assets Data ({{ assets.length }} items)</h3>

    <!-- JSON view for debugging -->
    <p-accordion>
      <p-accordionTab header="Raw JSON Data">
        <pre>{{ assets | json }}</pre>
      </p-accordionTab>
    </p-accordion>

    <!-- Table view if assets exist -->
    <div *ngIf="assets.length > 0" class="mt-4">
      <p-table
        [value]="assets"
        [responsive]="true"
        [paginator]="true"
        [rows]="10"
      >
        <ng-template pTemplate="header">
          <tr>
            <th *ngFor="let col of getAssetColumns()">{{ col }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-asset>
          <tr>
            <td *ngFor="let col of getAssetColumns()">
              {{ getAssetValue(asset, col) }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Empty state -->
    <div *ngIf="assets.length === 0" class="empty-state">
      <p-message severity="info" text="No assets found"></p-message>
    </div>
  </div>
</div>

<!-- Toast messages -->
<p-toast></p-toast>
